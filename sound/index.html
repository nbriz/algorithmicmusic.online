<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Algorithmic Music Online: Sound</title>
    <meta name="author" content="Nick Briz">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- TODO: social media stuff -->
    <link rel="stylesheet" href="/css/main.css">
    <style>
      .diagram {
        display: block;
        margin: 3em auto;
        aspect-ratio: 4 / 1;
        font-family: 'Libre Baskerville', Georgia, 'Times New Roman', serif;
        font-size: 0.8em;
        line-height: 0.6em;
        user-select: none;
      }

      am-range, am-button {
        display: block;
        width: 50%;
        margin: 0 auto;
        text-align: center;
      }

      .range-label {
        text-align: center;
        margin-bottom: 2em;
        margin-top: 1em;
      }
    </style>
  </head>
  <body>

    <main-menu>
      <div slot="menu-items">
        <div class="color-mode-wrap">
          <label class="color-mode-switch">
            <input type="checkbox">
            <span class="color-mode-slider"></span>
          </label>
          <span class="color-mode-label">light/dark mode</span>
        </div>
      </div>
    </main-menu>

    <section id="prologue">
      <div class="content">
        <h4 class="ch">week 1:</h4>
        <h2 class="formatted-text ch-title">sound</h2>

        <!-- <blockquote>
          <p>[the Analytical Engine] might act upon other things besides number, were objects found whose mutual fundamental relations could be expressed by those of the abstract science of operations, and which should be also susceptible of adaptations to the action of the operating notation and mechanism of the engine . . . supposing, for instance, that the fundamental relations of pitched sounds in the science of harmony and of musical composition were susceptible of such expression and adaptations, the engine might compose elaborate and scientific pieces of music of any degree of complexity or extent.</p>
          <cite><a href="https://en.wikipedia.org/wiki/Ada_Lovelace" target="_blank">Ada Lovelace</a> (sketch of the Analytical Engine) 1842</cite>
        </blockquote> -->

        <p>
          Before we talk about music, we need to talk about sound, what it is and how we’ll be making it. Sound happens when something vibrates, like a vocal chord, a guitar string or a speaker. These vibrations cause the tiny particles in the air around it to move, creating patterns of squished-together areas (compressions) and spread-out areas (rarefactions). These patterns travel outward as waves. When these waves reach your ears, they make your eardrum vibrate in the same pattern. Your brain takes these vibrations and processes them into what you experience as sound—like speech, music or noise. In a way, sound only exists in your mind: it's your brain's way of interpreting the physical vibrations in the air into a meaningful hallucination. Without a listener, “sound” is nothing more than patterns of vibrations in the air.
        </p>

        <svg id="physicalWave" class="diagram" viewBox="0 0 650 205" preserveAspectRatio="xMidYMid meet"></svg>

        <am-range id="speed" min="0" max="100" step="1"></am-range>
        <div class="range-label">vibration speed (aka "frequency" or "pitch")</div>

        <am-range id="intensity" min="0" max="100" step="1"></am-range>
        <div class="range-label">vibration intensity (aka "amplitude" or "volume")</div>

        <br><br>

        <p>
          The pitch of a sound depends on how fast the particles are vibrating, and the volume depends on how much they’re moving. A sound's <strong>pitch</strong> is also called its <strong>frequency</strong>, which is measured in <strong>hertz (Hz)</strong> or cycles per second. Faster vibrations create higher frequencies and higher-pitched sounds, while slower vibrations create lower frequencies and lower-pitched sounds. The <strong>volume</strong> (loudness) of a sound depends on the wave's <strong>amplitude</strong>—how strong or "tall" the wave is. Higher amplitude means louder sounds, and it's measured in <strong>decibels (dB)</strong>. A decibel is a unit that measures how loud a sound is, using a scale where every 10 dB means the sound is 10 times more intense than the previous level. In short, amplitude controls loudness, and frequency controls pitch.
        </p>

        <p>
          We'll be generating sound by vibrating speakers attached to our computer. These could be small headphone speakers or larger blue-tooth connected speakers.
        </p>
        <br>
        <br>
        <br>

        <h3 class="formatted-text">digital sound</h3>

        <p>
          So how can we tell our computer to vibrate its speakers? One way we can make sounds with our computer is by using a DAW (Digital Audio Workstation) like Ableton or FL Studio. Apps like these are perfect when you want to make music the same way everyone else does, but when we want to push the boundaries of music and leverage the full potential of this <a href="http://www.newmediareader.com/book_samples/nmr-26-kay.pdf" target="_blank">meta-medium</a> we turn to code. Rather than simply “use” software someone else wrote, we can “program” our own by writing code. When we use pre-made software we’re limited to the buttons, knobs and menus the developer created for us. While this saves us the time it would take to write our own, it also limits what/how we create to what/how that developer imagined we would want to create.
        </p>

        <p>
          There’s lots of different coding languages and environments used to create sound, because our goal is to create works that we can publish online for anyone to access on the open web, we’ll be using JavaScript, the web’s de facto programming language. A website or web app is written first and foremost in <a href="https://developer.mozilla.org/en-US/docs/Web/HTML" target="_blank">HTML</a>, a simple beginner friendly coding langauge for structuring content on the web. We won't be discussing HTML too much in this class, but if u're familiar with HTML (and <a href="https://developer.mozilla.org/en-US/docs/Web/CSS" target="_blank">CSS</a>) feel free to use them as much as you'd like in your work. In this class we'll be focusing almost exclusively on JavaScript, but we do need a little bit of HTML in order to write JavaScript in the browser, it starts with the <code>&lt;script&gt;</code> element, between which we can write JavaScript code. When we run JavaScript in a web browser we’re given access to the Web Audio API, a collection of pre-made functions for generating sound from scratch.
        </p>
      </div>
    </section>

    <section id="editor-1"></section>

    <hr>
    <br>
    <br>
    <br>

    <section>
      <div class="content">
        <h3 class="formatted-text">timbre</h3>

        <p>
          In the examples above we created two different sounds entirely from scratch, by calculating the raw data (number values) for each. These two sounds in some sense are opposites. The first was completely random, pure “noise” like the sound of a consonant in speech or the crash symbol on a drum set. The second was a “tone” like the sound of a vowel in speech or a key on a piano. It’s actually the purest tone we could make, the sound of a “sine wave”.
        </p>
        <am-button id="play-tone">play tone</am-button>
        <p class="small-note">(waveform not to scale, slowed down for demonstration)</p>
        <svg id="sineWave"></svg>

        <!-- <am-range id="freq" min="27.5" max="4186.009" step="1"></am-range> -->
        <am-range id="freq" min="220" max="880" step="1"></am-range>
        <div class="range-label">pitch <span id="freq-val">440</span> hz</div>

        <am-range id="vol" min="0" max="10" step="0.01"></am-range>
        <div class="range-label">volume <span id="vol-val">5</span></div>

        <p>
          However, pure sine waves don’t exist in the natural world, they can only ever be synthesized. Most real sounds with repetitive or predictable vibrations—what we hear as musical tones—are a mix of a <strong>fundamental</strong> frequency (the dominant tone, like 440 Hz for A4) and additional frequencies called <strong>overtones</strong> or <strong>harmonics</strong>. These overtones are multiples of the fundamental and give the sound its complexity.
        </p>

        <p>
          This mix of frequencies creates a sound’s <strong>timbre</strong>, the unique quality or texture that makes a guitar and a piano playing the same note sound different. While they share the same fundamental frequency, their overtones are emphasized differently, giving each instrument its distinctive "color." Overtones are what make musical tones rich and varied, compared to the pure simplicity of a sine wave.
        </p>

        <div id="timbre-ui" style="transform: translateY(3em);"></div>
        <svg id="timbre-wave"></svg>
        <p class="small-note" style="margin-top: -4em; text-align: left;"><span style="font-weight:bold;">above</span>: waveform (shape of vibration) | <span style="font-weight:bold;">below</span>: spectrum analyzer (fundamental frequency and harmonics)</p>
        <svg id="timbre-spec"></svg>

        <p>
          In digital audio, we often describe four basic wave types, each with unique characteristics. Sine waves are pure tones, containing only the fundamental frequency with no harmonics, making them smooth and simple. Square waves are richer, combining the fundamental with only the odd-numbered harmonics (e.g., 3rd, 5th, 7th), giving them a buzzy, hollow sound. Saw waves are even more complex, containing the fundamental and all harmonics, which creates a bright, edgy sound often used in synth music. Triangle waves are similar to square waves but softer; they also include only odd harmonics, but the higher harmonics are much quieter, resulting in a more subdued, rounded tone. Each wave shape has a distinct frequency content, shaping its sound and timbre.
        </p>
      </div>
    </section>

    <section id="editor-2"></section>

    <section>
      <div class="content">
        <p>

        </p>
      </div>
    </section>

    <section id="editor-3"></section>

    <br>
    <br>
    <br>

    <section class="attribution">
      <div class="content">
        <p>
          <span style="font-weight: bold;">Attribution</span>: Text and code written by <a href="https://nickbriz.com/" target="_blank">Nick Briz</a>. The code editor icons designed by <a href="https://thenounproject.com/creator/MekoDa/" target="_blank">Meko</a> and licensed under Creative Commons Attribution License (CC BY 3.0). Air pressure and sine wave diagram remixed from Jack Schaedler's <a href="https://jackschaedler.github.io/circles-sines-signals" target="_blank">Seeing Circles, Sines and Signals</a>. All sounds generated using the Web Audio API and/or <a href="https://tonejs.github.io/" target="_blank">Tone.js</a> by Yotam Mann and <a href="https://github.com/Tonejs/Tone.js/graphs/contributors" target="_blank">other contributors</a>.
        </p>
      </div>
    </section>


    <script src="/js/libs/d3@7.js"></script>
    <script src="/js/libs/Tone.js"></script>
    <script src="/js/libs/netitor.min.js"></script>
    <script src="/js/libs/nn.min.js"></script>
    <script src="/js/custom-elements/main-menu.js"></script>
    <script src="/js/custom-elements/algo-music-ui.js"></script>
    <script src="/js/jack/sound_wave.js"></script>
    <script src="/js/jack/sound-1.js"></script>
    <script src="/js/SVGSineWave.js"></script>
    <script src="/js/create-waveform.js"></script>
    <script src="/js/create-spectrum.js"></script>
    <script src="/js/utils.js"></script>
    <script>
      utils.init()
      nn.getAll('h4, .formatted-text').forEach(e => utils.formatText(e))

      // sound vibration diagram
      nn.get('#speed').value = 12
      nn.get('#speed').on('input', () => {
        const v = parseFloat(nn.get('#speed').value)
        window.updateSpeed(v)
      })
      nn.get('#intensity').value = 50
      nn.get('#intensity').on('input', () => {
        const v = parseFloat(nn.get('#intensity').value)
        window.updateAmount(v)
      })

      // code examples
      // --------------------------------------------
      utils.createCodeEditor({
        ele: '#editor-1',
        title: 'raw audio data',
        fileprefix: 'sound-',
        total: 8
      })

      utils.createCodeEditor({
        ele: '#editor-2',
        title: 'shaping waveforms',
        fileprefix: 'timbre-',
        template: [0, 0, 0, 0, 3, 3, 3, 3],
        index: 7,
        total: 8
      })

      utils.createCodeEditor({
        ele: '#editor-3',
        fileprefix: 'theramin',
        template: 3
      })


      // sine wave diagram
      // --------------------------------------------
      const sineWave = new SVGSineWave({
        svg: '#sineWave',
        frequency: 12,
        amplitude: 0.5,
        colors: ['var(--text-color)', 'var(--accent-color1)'],
        width: nn.get('.content').width
      })

      nn.on('resize', () => {
        sineWave.update({ width: nn.get('.content').width })
      })

      nn.get('#freq').value = 440
      nn.get('#freq').on('input', () => {
        const v = parseFloat(nn.get('#freq').value)
        sineWave.update({ frequency: nn.map(v, 440, 880, 12, 24) })
        nn.get('#freq-val').content(nn.get('#freq').value)
      })
      nn.get('#vol').value = 5
      nn.get('#vol').on('input', () => {
        const v = parseFloat(nn.get('#vol').value)
        sineWave.update({ amplitude: nn.map(v, 0, 10, 0, 1) })
        nn.get('#vol-val').content(nn.get('#vol').value)
      })

      nn.get('#play-tone').on('click', () => {
        const ctx = new window.AudioContext()
        const lvl = ctx.createGain()
        lvl.gain.value = parseFloat(nn.get('#vol').value) / 10
        const tone = ctx.createOscillator()
        tone.frequency.value = nn.get('#freq').value
        tone.connect(lvl)
        lvl.connect(ctx.destination)

        tone.start(ctx.currentTime)
        tone.stop(ctx.currentTime + 0.25)
      })

      // timbre diagram
      // --------------------------------------------
      const wave = createWaveform({
        ele: '#timbre-wave',
        background: 'var(--background-color)',
        color: 'var(--accent-color1)'
      })
      wave.animate()
      const spec = createSpectrum({
        ele: '#timbre-spec',
        background: 'var(--background-color)',
        color: 'var(--accent-color1)',
        harmonics: true,
        range: [20, 7050]
      })
      spec.animate()

      const osc = new Tone.Oscillator(440, "sine").toDestination()
      osc.connect(wave.node)
      osc.connect(spec.node)

      nn.create('button')
        .addTo('#timbre-ui')
        .content('start')
        .on('click', () => {
          osc.start()
        })

      nn.create('button')
        .addTo('#timbre-ui')
        .content('stop')
        .on('click', () => {
          osc.stop()
        })

      nn.create('select')
        .set({ id: 'wave-types' })
        .addTo('#timbre-ui')
        .on('input', (e) => {
          osc.type = e.target.value
        })

      const types = ['sine', 'square', 'triangle', 'sawtooth']
      types.forEach(type => {
        nn.create('option')
        .content(type)
        .set({ value: type })
        .addTo('#wave-types')
      })

      nn.create('input')
        .set({ type: 'number', value: 0, min: 0, step: 1 })
        .css({ width: '6em' })
        .addTo('#timbre-ui')
        .on('input', (e) => {
          const type = nn.get('#wave-types').value
          const vals = e.target.value
          const part = vals !== '' && vals > 0 ? type + vals : type
          osc.type = part
          console.log(osc.type);
        })


    </script>
  </body>
</html>
