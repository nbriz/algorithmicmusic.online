/*
  The example below assumes you've connected a [KORG nanoKONTROL](https://www.korg.com/us/products/computergear/nanokontrol2/) MIDI controller to your computer, and uses the first two knobs and sliders to control the parameters of the Phaser effect.

  NOTE: this works on Chrome, but sadly not on Firefox
*/

const wave = viz.createWaveform()
const osc = new Tone.Oscillator(440, 'sine')
const effect = new Tone.Phaser()

osc.connect(effect)
effect.toDestination()
effect.connect(wave)

function updateEffect (msg) {
  // use the "Play" button on the controller (channel 41)
  if (msg.chl === 41) { // to start/stop the Osc
    if (msg.val === 127) osc.start()
    else if (msg.val === 0) osc.stop()
  }
  // use the knobs to control the effects paramters
  if (msg.chl === 16) {
    const f = nn.map(msg.val, 1, 126, 1, 20)
    effect.set({ frequency: f })
  }
  if (msg.chl === 17) {
    const o = nn.map(msg.val, 1, 126, 0.1, 4)
    effect.set({ octaves: o })
  }
  if (msg.chl === 18) {
    const q = nn.map(msg.val, 1, 126, 1, 20)
    effect.set({ Q: q })
  }
  if (msg.chl === 19) {
    const b = nn.map(msg.val, 1, 126, 100, 10000)
    effect.set({ baseFrequency: b })
  }
}

// run the function every time we receive a new MIDI message
nn.MIDI(updateEffect)
